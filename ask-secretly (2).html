<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Secretly üí≠</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #dc2626;
            --primary-hover: #b91c1c;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }
        .container { max-width: 600px; margin: 0 auto; }
        
        .header {
            background: #000;
            border-bottom: 1px solid #2f3336;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo { font-size: 24px; font-weight: bold; color: var(--primary); }
        .logout-btn {
            background: none;
            border: 1px solid #536471;
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        .logout-btn:hover { background: #1a1a1a; }

        textarea {
            width: 100%;
            background: #000;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 15px;
            color: #fff;
            font-size: 15px;
            resize: none;
            min-height: 100px;
            font-family: inherit;
        }
        textarea:focus { outline: none; border-color: var(--primary); }
        
        .send-btn {
            width: 100%;
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 14px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 12px;
        }
        .send-btn:hover { background: var(--primary-hover); }
        .send-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Ask Page */
        .ask-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .ask-card {
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
        }
        .ask-card .emoji { font-size: 60px; text-align: center; margin-bottom: 20px; }
        .ask-card h1 { text-align: center; font-size: 28px; margin-bottom: 10px; color: var(--primary); }
        .ask-card .username-display { text-align: center; font-size: 18px; color: #71767b; margin-bottom: 30px; }
        .anonymous-note { text-align: center; color: #71767b; font-size: 13px; margin-top: 15px; }
        .char-count { text-align: right; color: #71767b; font-size: 12px; margin-top: 5px; }

        /* Auth Pages */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-card {
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }
        .auth-card h1 { text-align: center; font-size: 32px; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 14px; margin-bottom: 8px; color: #e7e9ea; }
        .form-group input {
            width: 100%;
            background: #000;
            border: 1px solid #2f3336;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 15px;
        }
        .form-group input:focus { outline: none; border-color: var(--primary); }
        .auth-btn {
            width: 100%;
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 14px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .auth-btn:hover { background: var(--primary-hover); }
        .auth-btn.secondary { background: #000; border: 1px solid var(--primary); margin-top: 15px; }
        .auth-link { text-align: center; margin-top: 20px; color: #71767b; font-size: 14px; }
        .auth-link a { color: var(--primary); text-decoration: none; cursor: pointer; }

        /* Dashboard */
        .dashboard-header { padding: 20px; border-bottom: 1px solid #2f3336; }
        .profile-box {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        .username { font-size: 20px; font-weight: bold; }
        .handle { color: #71767b; font-size: 15px; }
        
        .link-box {
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .link-box label { font-size: 14px; color: #71767b; display: block; margin-bottom: 8px; }
        .link-box p { font-size: 12px; color: #71767b; margin-top: 8px; }
        .link-input-group { display: flex; gap: 10px; }
        .link-input-group input {
            flex: 1;
            background: #000;
            border: 1px solid #2f3336;
            border-radius: 8px;
            padding: 10px;
            color: #fff;
            font-size: 14px;
        }
        .copy-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .tabs { display: flex; border-bottom: 1px solid #2f3336; margin-top: 20px; }
        .tab {
            flex: 1;
            background: none;
            border: none;
            color: #71767b;
            padding: 15px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            border-bottom: 2px solid transparent;
        }
        .tab.active { color: #fff; border-bottom-color: var(--primary); }

        .inbox-item {
            background: #1a1a1a;
            border: 1px solid #2f3336;
            border-radius: 16px;
            padding: 20px;
            margin: 15px 20px;
        }
        .question-text {
            font-size: 15px;
            line-height: 1.5;
            color: #e7e9ea;
            background: #000;
            padding: 15px;
            border-radius: 12px;
            border-left: 3px solid var(--primary);
            margin-bottom: 15px;
        }
        .answer-text { font-size: 15px; line-height: 1.5; color: #fff; margin-bottom: 15px; }
        .answer-input {
            width: 100%;
            background: #000;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
            resize: none;
            min-height: 80px;
            margin-top: 12px;
        }
        .answer-btn {
            width: 100%;
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 12px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .delete-btn {
            background: none;
            border: none;
            color: #71767b;
            font-size: 13px;
            cursor: pointer;
            margin-top: 10px;
        }
        .delete-btn:hover { color: #f4212e; }
        .question-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #2f3336;
        }
        .date { font-size: 13px; color: #71767b; }
        .share-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .empty-state { text-align: center; padding: 40px; color: #71767b; }
        .hidden { display: none !important; }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: #fff;
            padding: 15px 25px;
            border-radius: 12px;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #71767b;
        }
        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div id="notification" class="notification"></div>

    <!-- Landing Page -->
    <div id="landingPage" class="auth-page">
        <div class="auth-card">
            <h1>üí≠ Ask Secretly</h1>
            <p style="text-align: center; color: #71767b; margin-bottom: 30px;">Anonim soru sor, cevap al!</p>
            <button class="auth-btn" onclick="showSignup()">Kayƒ±t Ol</button>
            <button class="auth-btn secondary" onclick="showLogin()">Giri≈ü Yap</button>
        </div>
    </div>

    <!-- Signup Page -->
    <div id="signupPage" class="auth-page hidden">
        <div class="auth-card">
            <h1>Hesap Olu≈ütur</h1>
            <div class="form-group">
                <label>Kullanƒ±cƒ± Adƒ±</label>
                <input type="text" id="signupUsername" placeholder="kullaniciadi">
            </div>
            <div class="form-group">
                <label>≈ûifre</label>
                <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="auth-btn" onclick="handleSignup()">Hesap Olu≈ütur</button>
            <div class="auth-link">
                Hesabƒ±n var mƒ±? <a onclick="showLogin()">Giri≈ü Yap</a>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="auth-page hidden">
        <div class="auth-card">
            <h1>Giri≈ü Yap</h1>
            <div class="form-group">
                <label>Kullanƒ±cƒ± Adƒ±</label>
                <input type="text" id="loginUsername" placeholder="kullaniciadi">
            </div>
            <div class="form-group">
                <label>≈ûifre</label>
                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="auth-btn" onclick="handleLogin()">Giri≈ü Yap</button>
            <div class="auth-link">
                Hesabƒ±n yok mu? <a onclick="showSignup()">Kayƒ±t Ol</a>
            </div>
        </div>
    </div>

    <!-- Ask Page (Soru Sorma) -->
    <div id="askPage" class="ask-page hidden">
        <div class="ask-card">
            <div class="emoji">üí≠</div>
            <h1>Anonim Soru Sor</h1>
            <div class="username-display" id="askUsername"></div>
            <textarea id="questionInput" placeholder="Sorunuzu buraya yazƒ±n..." maxlength="500"></textarea>
            <div class="char-count"><span id="charCount">0</span>/500</div>
            <button class="send-btn" id="sendBtn" onclick="sendQuestion()">G√∂nder</button>
            <div class="anonymous-note">üîí Kimliƒüin tamamen gizli kalacak</div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="hidden">
        <div class="header">
            <div class="logo">Ask Secretly</div>
            <button class="logout-btn" onclick="logout()">√áƒ±kƒ±≈ü</button>
        </div>
        <div class="container">
            <div class="dashboard-header">
                <div class="profile-box">
                    <div class="avatar" id="dashAvatar"></div>
                    <div>
                        <div class="username" id="dashUsername"></div>
                        <div class="handle" id="dashHandle"></div>
                    </div>
                </div>
                
                <div class="link-box">
                    <label>üí≠ Soru Sor Linkin</label>
                    <div class="link-input-group">
                        <input type="text" id="profileLink" readonly>
                        <button class="copy-btn" onclick="copyLink()">Kopyala</button>
                    </div>
                    <p>Bu linki payla≈ü, sana anonim soru sorsunlar!</p>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="inbox" onclick="switchTab('inbox')">
                    Gelen Kutusu (<span id="inboxCount">0</span>)
                </button>
                <button class="tab" data-tab="answered" onclick="switchTab('answered')">
                    Cevaplanmƒ±≈ü (<span id="answeredCount">0</span>)
                </button>
            </div>

            <div id="feedContainer"></div>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDakHbGCdOMrROtwF67GJK-BrjwOxje6Jo",
            authDomain: "ask-directly.firebaseapp.com",
            projectId: "ask-directly",
            storageBucket: "ask-directly.firebasestorage.app",
            messagingSenderId: "723864585647",
            appId: "1:723864585647:web:9bdef0e3f504e62c681b5a"
        };

        // Firebase'i ba≈ülat
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Deƒüi≈ükenler
        let currentUser = JSON.parse(localStorage.getItem('askSecretly_currentUser') || 'null');
        let currentTab = 'inbox';

        // Yardƒ±mcƒ± Fonksiyonlar
        function showNotification(msg) {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.style.display = 'block';
            setTimeout(() => notif.style.display = 'none', 3000);
        }

        function showPage(pageId) {
            ['landingPage', 'signupPage', 'loginPage', 'askPage', 'dashboardPage'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showLanding() { showPage('landingPage'); }
        function showSignup() { showPage('signupPage'); }
        function showLogin() { showPage('loginPage'); }

        // Karakter sayacƒ±
        document.getElementById('questionInput')?.addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });

        // Kayƒ±t Ol
        async function handleSignup() {
            const username = document.getElementById('signupUsername').value.toLowerCase().trim();
            const password = document.getElementById('signupPassword').value;

            if (username.length < 3) {
                showNotification('Kullanƒ±cƒ± adƒ± en az 3 karakter olmalƒ±!');
                return;
            }
            if (password.length < 4) {
                showNotification('≈ûifre en az 4 karakter olmalƒ±!');
                return;
            }

            try {
                // Kullanƒ±cƒ± var mƒ± kontrol et
                const userDoc = await db.collection('users').doc(username).get();
                if (userDoc.exists) {
                    showNotification('Bu kullanƒ±cƒ± adƒ± alƒ±nmƒ±≈ü!');
                    return;
                }

                // Kullanƒ±cƒ±yƒ± kaydet
                await db.collection('users').doc(username).set({
                    username: username,
                    password: password,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                currentUser = { username };
                localStorage.setItem('askSecretly_currentUser', JSON.stringify(currentUser));
                
                showNotification('Hesap olu≈üturuldu! üéâ');
                loadDashboard();
            } catch (error) {
                console.error('Kayƒ±t hatasƒ±:', error);
                showNotification('Bir hata olu≈ütu!');
            }
        }

        // Giri≈ü Yap
        async function handleLogin() {
            const username = document.getElementById('loginUsername').value.toLowerCase().trim();
            const password = document.getElementById('loginPassword').value;

            try {
                const userDoc = await db.collection('users').doc(username).get();
                
                if (!userDoc.exists || userDoc.data().password !== password) {
                    showNotification('Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±!');
                    return;
                }

                currentUser = { username };
                localStorage.setItem('askSecretly_currentUser', JSON.stringify(currentUser));
                
                showNotification('Ho≈ü geldin! üí≠');
                loadDashboard();
            } catch (error) {
                console.error('Giri≈ü hatasƒ±:', error);
                showNotification('Bir hata olu≈ütu!');
            }
        }

        // √áƒ±kƒ±≈ü Yap
        function logout() {
            currentUser = null;
            localStorage.removeItem('askSecretly_currentUser');
            showNotification('√áƒ±kƒ±≈ü yapƒ±ldƒ±!');
            showLanding();
        }

        // Soru Sorma Sayfasƒ±nƒ± Y√ºkle
        async function loadAskPage(username) {
            try {
                const userDoc = await db.collection('users').doc(username).get();
                
                if (!userDoc.exists) {
                    showNotification('Kullanƒ±cƒ± bulunamadƒ±!');
                    showLanding();
                    return;
                }

                document.getElementById('askUsername').textContent = `@${username} kullanƒ±cƒ±sƒ±na`;
                document.getElementById('questionInput').value = '';
                document.getElementById('charCount').textContent = '0';
                
                showPage('askPage');
            } catch (error) {
                console.error('Sayfa y√ºkleme hatasƒ±:', error);
                showNotification('Bir hata olu≈ütu!');
            }
        }

        // Soru G√∂nder
        async function sendQuestion() {
            const btn = document.getElementById('sendBtn');
            const text = document.getElementById('questionInput').value.trim();
            
            if (!text) {
                showNotification('Soru yazmalƒ±sƒ±n!');
                return;
            }
            if (text.length < 3) {
                showNotification('Soru en az 3 karakter olmalƒ±!');
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('u');
            
            if (!username) {
                showNotification('Ge√ßersiz kullanƒ±cƒ±!');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'G√∂nderiliyor...';

            try {
                await db.collection('questions').add({
                    to: username,
                    question: text,
                    answer: null,
                    isAnswered: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                document.getElementById('questionInput').value = '';
                document.getElementById('charCount').textContent = '0';
                showNotification('Sorun g√∂nderildi! ‚úÖ');
            } catch (error) {
                console.error('Soru g√∂nderme hatasƒ±:', error);
                showNotification('Bir hata olu≈ütu!');
            } finally {
                btn.disabled = false;
                btn.textContent = 'G√∂nder';
            }
        }

        // Dashboard'u Y√ºkle
        function loadDashboard() {
            if (!currentUser) {
                showLanding();
                return;
            }

            document.getElementById('dashAvatar').textContent = currentUser.username[0].toUpperCase();
            document.getElementById('dashUsername').textContent = currentUser.username;
            document.getElementById('dashHandle').textContent = '@' + currentUser.username;
            document.getElementById('profileLink').value = `${window.location.origin}${window.location.pathname}?u=${currentUser.username}`;

            showPage('dashboardPage');
            switchTab('inbox');
        }

        // Sekme Deƒüi≈ütir
        async function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');

            const container = document.getElementById('feedContainer');
            container.innerHTML = '<div class="loading">Y√ºkleniyor</div>';

            try {
                const snapshot = await db.collection('questions')
                    .where('to', '==', currentUser.username)
                    .where('isAnswered', '==', tab === 'answered')
                    .orderBy('createdAt', 'desc')
                    .get();

                const questions = [];
                snapshot.forEach(doc => {
                    questions.push({ id: doc.id, ...doc.data() });
                });

                // Sayƒ±larƒ± g√ºncelle
                const allSnapshot = await db.collection('questions')
                    .where('to', '==', currentUser.username)
                    .get();
                
                let inboxCount = 0, answeredCount = 0;
                allSnapshot.forEach(doc => {
                    if (doc.data().isAnswered) answeredCount++;
                    else inboxCount++;
                });
                
                document.getElementById('inboxCount').textContent = inboxCount;
                document.getElementById('answeredCount').textContent = answeredCount;

                if (questions.length === 0) {
                    container.innerHTML = '<div class="empty-state">Hen√ºz soru yok</div>';
                    return;
                }

                container.innerHTML = '';
                questions.forEach(q => {
                    const div = document.createElement('div');
                    div.className = 'inbox-item';
                    
                    const date = q.createdAt ? new Date(q.createdAt.toDate()).toLocaleDateString('tr-TR') : '';
                    
                    if (q.isAnswered) {
                        div.innerHTML = `
                            <div class="question-text">${escapeHtml(q.question)}</div>
                            <div class="answer-text">${escapeHtml(q.answer)}</div>
                            <div class="question-footer">
                                <div class="date">${date}</div>
                                <button class="share-btn" onclick="shareToTwitter('${q.id}', '${escapeHtml(q.question).replace(/'/g, "\\'")}', '${escapeHtml(q.answer).replace(/'/g, "\\'")}')">
                                    üê¶ Payla≈ü
                                </button>
                            </div>
                        `;
                    } else {
                        div.innerHTML = `
                            <div class="question-text">${escapeHtml(q.question)}</div>
                            <textarea class="answer-input" id="answer-${q.id}" placeholder="Cevabƒ±nƒ± yaz..."></textarea>
                            <button class="answer-btn" onclick="answerQuestion('${q.id}')">Cevapla</button>
                            <button class="delete-btn" onclick="deleteQuestion('${q.id}')">üóëÔ∏è Sil</button>
                        `;
                    }
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Sorular y√ºklenemedi:', error);
                container.innerHTML = '<div class="empty-state">Sorular y√ºklenemedi</div>';
            }
        }

        // Soruyu Cevapla
        async function answerQuestion(id) {
            const answer = document.getElementById('answer-' + id).value.trim();
            if (!answer) {
                showNotification('Cevap yazmalƒ±sƒ±n!');
                return;
            }

            try {
                await db.collection('questions').doc(id).update({
                    answer: answer,
                    isAnswered: true,
                    answeredAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showNotification('Cevap kaydedildi! üí¨');
                switchTab(currentTab);
            } catch (error) {
                console.error('Cevaplama hatasƒ±:', error);
                showNotification('Bir hata olu≈ütu!');
            }
        }

        // Soruyu Sil
        async function deleteQuestion(id) {
            if (!confirm('Bu soruyu silmek istediƒüine emin misin?')) return;

            try {
                await db.collection('questions').doc(id).delete();
                showNotification('Soru silindi!');
                switchTab(currentTab);
            } catch (error) {
                console.error('Silme hatasƒ±:', error);
                showNotification('Bir hata olu≈ütu!');
            }
        }

        // Link Kopyala
        function copyLink() {
            const link = document.getElementById('profileLink');
            link.select();
            document.execCommand('copy');
            showNotification('Link kopyalandƒ±! üìã');
        }

        // Twitter'da Payla≈ü
        function shareToTwitter(id, question, answer) {
            const tweetText = `${question}\n\n${answer}\n\nBana da anonim soru sor üëá\n${window.location.origin}${window.location.pathname}?u=${currentUser.username}`;
            const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
            window.open(twitterUrl, '_blank');
        }

        // Sayfa Y√ºklendiƒüinde
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('u');
            
            // URL'de kullanƒ±cƒ± adƒ± varsa soru sorma sayfasƒ±nƒ± g√∂ster
            if (username) {
                loadAskPage(username);
                return;
            }
            
            // Giri≈ü yapmƒ±≈üsa dashboard'a git
            if (currentUser) {
                loadDashboard();
            } else {
                showLanding();
            }
        };
    </script>
</body>
</html>
